<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Latihan Soal IPAS - Kelas 4A</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600;700&family=Nunito:wght@400;700;800&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --primary: #4CAF50;
            --wrong: #FF5252;
            --blue-dark: #1565C0; /* Warna Background Soal */
            --bg-gradient: linear-gradient(135deg, #FFDEE9 0%, #B5FFFC 100%);
            --card-shadow: 0 8px 0 rgba(0,0,0,0.15);
            --btn-shadow: 0 4px 0 #ccc;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            background: var(--bg-gradient);
            min-height: 100vh;
            font-family: 'Nunito', sans-serif; /* Font bulat nyaman dibaca anak */
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 15px;
            overflow-x: hidden;
        }

        /* Dekorasi Background Bergerak */
        body::before {
            content: '';
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background-image: radial-gradient(rgba(255,255,255,0.4) 10%, transparent 10%);
            background-size: 30px 30px;
            z-index: -1;
            opacity: 0.7;
        }

        .container {
            width: 100%;
            max-width: 900px;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border-radius: 25px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.2);
            border: 5px solid #fff;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            position: relative;
            animation: slideUp 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        @keyframes slideUp {
            from { transform: translateY(50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        /* --- HEADER KEREN --- */
        .header {
            background: #fff;
            padding: 20px 15px;
            text-align: center;
            border-bottom: 3px dashed #bbdefb;
            position: relative;
            z-index: 10;
        }

        .main-title {
            font-family: 'Fredoka', sans-serif;
            font-size: 2rem;
            color: #0288D1;
            margin-bottom: 5px;
            text-transform: uppercase;
            text-shadow: 3px 3px 0px #E1F5FE;
            letter-spacing: 1px;
        }

        .school-info {
            font-size: 1.1rem;
            font-weight: 800;
            color: #555;
            margin-bottom: 10px;
        }

        .teacher-badge {
            display: inline-block;
            background: linear-gradient(to right, #4facfe 0%, #00f2fe 100%);
            color: white;
            padding: 8px 20px;
            border-radius: 50px;
            font-size: 0.95rem;
            font-weight: 700;
            box-shadow: 0 4px 10px rgba(0, 198, 251, 0.4);
        }

        .content { padding: 25px; }

        /* --- INPUT NAMA --- */
        .input-group { text-align: center; margin-top: 20px; }
        
        .name-input {
            width: 100%;
            max-width: 450px;
            padding: 18px;
            border: 3px solid #E0E0E0;
            border-radius: 20px;
            font-size: 1.3rem;
            text-align: center;
            margin-bottom: 25px;
            font-family: 'Fredoka', sans-serif;
            transition: 0.3s;
            background: #FAFAFA;
        }
        
        .name-input:focus { border-color: #29B6F6; outline: none; box-shadow: 0 0 15px rgba(41, 182, 246, 0.3); }

        .start-btn {
            background: linear-gradient(to bottom, #FFEB3B, #FBC02D);
            color: #4E342E;
            border: none;
            padding: 18px 60px;
            border-radius: 50px;
            font-size: 1.4rem;
            font-family: 'Fredoka', sans-serif;
            font-weight: 700;
            cursor: pointer;
            box-shadow: 0 6px 0 #F57F17, 0 10px 20px rgba(0,0,0,0.2);
            transition: all 0.1s;
            width: 100%;
            max-width: 350px;
        }
        
        .start-btn:active { transform: translateY(6px); box-shadow: 0 0 0 #F57F17; }
        .start-btn:disabled { background: #E0E0E0; color: #9E9E9E; box-shadow: none; cursor: not-allowed; transform: none; }

        /* --- QUIZ AREA --- */
        .status-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: #E3F2FD;
            padding: 12px 20px;
            border-radius: 15px;
            color: #1565C0;
            font-weight: 800;
            font-size: 1.1rem;
            margin-bottom: 25px;
            border: 2px solid #BBDEFB;
        }

        /* KOTAK SOAL (Bedakan dengan Opsi) */
        .question-box {
            background: var(--blue-dark); /* Background Gelap */
            color: #fff; /* Teks Putih */
            padding: 25px;
            border-radius: 20px;
            text-align: center;
            margin-bottom: 25px;
            box-shadow: 0 10px 25px rgba(21, 101, 192, 0.3);
            position: relative;
            border: 4px solid #0D47A1;
            animation: popInQuestion 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        @keyframes popInQuestion {
            from { transform: scale(0.9); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        .question-text {
            font-size: 1.4rem;
            font-weight: 700;
            line-height: 1.5;
            font-family: 'Fredoka', sans-serif;
        }
        
        .speaker-btn {
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            padding: 8px 12px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.2rem;
            margin-left: 10px;
            transition: 0.3s;
            vertical-align: middle;
        }
        .speaker-btn:hover { background: rgba(255,255,255,0.4); transform: scale(1.1); }

        /* GRID OPSI JAWABAN (2 KOLOM) */
        .options-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            width: 100%;
        }

        .option-btn {
            background: #FFFFFF;
            border: 2px solid #E0E0E0;
            border-bottom: 6px solid #BDBDBD; /* Efek 3D */
            border-radius: 18px;
            padding: 15px 20px;
            font-size: 1.1rem;
            color: #424242;
            cursor: pointer;
            text-align: left;
            display: flex;
            align-items: center;
            min-height: 80px; /* Tinggi tombol enak buat touch */
            transition: all 0.1s;
            font-family: 'Nunito', sans-serif;
            font-weight: 700;
            position: relative;
            overflow: hidden;
        }

        .option-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            background: #F5F5F5;
            border-color: #29B6F6;
        }

        .option-btn:active:not(:disabled) {
            transform: translateY(4px);
            border-bottom-width: 2px;
            background: #EEEEE0;
        }

        .option-label {
            background: #ECEFF1;
            color: #546E7A;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            flex-shrink: 0;
            font-weight: 800;
        }

        /* Style Jawaban Benar & Salah */
        .option-btn.correct {
            background: #DCEDC8; 
            border-color: #558B2F; 
            border-bottom-color: #33691E; 
            color: #33691E;
        }
        .option-btn.correct .option-label { background: #AED581; color: #1B5E20; }

        .option-btn.incorrect {
            background: #FFCDD2; 
            border-color: #C62828; 
            border-bottom-color: #8B0000; 
            color: #B71C1C; 
            opacity: 0.8;
        }
        .option-btn.incorrect .option-label { background: #EF9A9A; color: #B71C1C; }

        /* --- POPUP JUMBO --- */
        .popup-jumbo {
            position: fixed;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%) scale(0);
            font-family: 'Fredoka', sans-serif;
            font-weight: 900;
            z-index: 9999;
            pointer-events: none;
            text-shadow: 5px 5px 0 rgba(0,0,0,0.1);
            filter: drop-shadow(0 10px 20px rgba(0,0,0,0.3));
        }

        .pop-plus { color: #00E676; font-size: 15rem; animation: popIn 1.2s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards; }
        .pop-zero { color: #FF1744; font-size: 12rem; animation: popIn 1.2s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards; }

        @keyframes popIn {
            0% { transform: translate(-50%, -50%) scale(0) rotate(-25deg); opacity: 0; }
            50% { transform: translate(-50%, -50%) scale(1.3) rotate(0deg); opacity: 1; }
            100% { transform: translate(-50%, -50%) scale(1) rotate(0deg); opacity: 0; }
        }

        /* --- HASIL SKOR --- */
        .score-circle {
            width: 160px; height: 160px;
            background: conic-gradient(#4CAF50 0%, #00E676 100%);
            color: white;
            border-radius: 50%;
            display: flex; justify-content: center; align-items: center;
            font-size: 4rem; font-family: 'Fredoka', sans-serif;
            margin: 0 auto 25px;
            box-shadow: 0 10px 30px rgba(76, 175, 80, 0.4);
            border: 8px solid #E8F5E9;
            animation: bounceIn 1s;
        }
        
        @keyframes bounceIn {
            0% { transform: scale(0); }
            60% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        /* Responsive Mobile */
        @media (max-width: 500px) {
            .main-title { font-size: 1.5rem; }
            .question-box { padding: 15px; }
            .question-text { font-size: 1.1rem; }
            .options-grid { gap: 10px; }
            .option-btn { font-size: 0.95rem; padding: 12px; min-height: 70px; }
            .container { border-radius: 15px; }
        }
    </style>
</head>
<body>

    <div class="container">
        <div class="header">
            <h1 class="main-title">LATIHAN SOAL IPAS</h1>
            <div class="school-info">SDN KARANGSAMBUNG 03 ‚Ä¢ KELAS 4A</div>
            <div class="teacher-badge">WALI KELAS: SITI ARUM GITA NURMALA</div>
        </div>
        
        <div class="content">
            <div id="inputSection" class="input-group">
                <img src="https://img.icons8.com/color/96/student-male--v1.png" alt="Icon Siswa" style="margin-bottom: 10px;">
                <h3 style="margin-bottom: 10px; color: #546E7A;">Halo! Siapa namamu?</h3>
                <input type="text" id="nameInput" class="name-input" placeholder="Ketik namamu di sini..." autocomplete="off">
                <button id="startBtn" class="start-btn" disabled>üöÄ MULAI PETUALANGAN</button>
            </div>
            
            <div id="quizSection" style="display: none;">
                <div class="status-bar">
                    <span id="qCount">‚≠ê Soal 1/20</span>
                    <span id="timerDisplay">‚è±Ô∏è 00:00</span>
                </div>
                
                <div id="questionContainer">
                    </div>
            </div>
            
            <div id="resultSection" style="display: none; text-align: center;">
                <h2 style="margin-bottom: 20px; color: #455A64; font-family: 'Fredoka', sans-serif;">üéâ Hebat! Kamu Sudah Selesai!</h2>
                <div class="score-circle" id="finalScoreDisplay">100</div>
                
                <div style="background: #F1F8E9; padding: 20px; border-radius: 20px; text-align: left; margin-bottom: 25px; border: 2px solid #DCEDC8;">
                    <p style="margin-bottom: 10px; border-bottom: 1px dashed #ccc; padding-bottom: 5px;">üë§ <b>Nama:</b> <span id="resName" style="float: right;">-</span></p>
                    <p style="margin-bottom: 10px; border-bottom: 1px dashed #ccc; padding-bottom: 5px;">‚úÖ <b>Benar:</b> <span id="resCorrect" style="float: right; color:green; font-weight:bold;">-</span></p>
                    <p style="margin-bottom: 10px; border-bottom: 1px dashed #ccc; padding-bottom: 5px;">‚ùå <b>Salah:</b> <span id="resWrong" style="float: right; color:red; font-weight:bold;">-</span></p>
                    <p>‚è≥ <b>Waktu:</b> <span id="resTime" style="float: right;">-</span></p>
                </div>

                <div id="saveStatus" style="font-weight: bold; color: #1565C0; margin-bottom: 20px; background: #E3F2FD; padding: 10px; border-radius: 10px;">
                    üîÑ Sedang mengirim nilai...
                </div>
                
                <button class="start-btn" onclick="location.reload()">üîÑ MAIN LAGI</button>
            </div>
        </div>
    </div>

    <script>
        // --- KONFIGURASI GOOGLE SHEET ---
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbytpbJW8A0xcFInstDWY8rdB0mNF18AEA4mpyff3iDG0CoGNa6kvBi8Cygn_i-Ro_gI/exec';
        
        // --- DATA SOAL ---
        const allQuestions = [
            { question: "Apa yang dimaksud dengan bentang alam?", options: ["Bangunan buatan manusia", "Kenampakan alami di bumi", "Peta wilayah", "Cuaca dan iklim"], correct: 1 },
            { question: "Bentang alam yang tinggi dengan puncak disebut?", options: ["Bukit", "Gunung", "Dataran", "Lembah"], correct: 1 },
            { question: "Pertemuan antara daratan dan laut disebut?", options: ["Teluk", "Pantai", "Sungai", "Laguna"], correct: 1 },
            { question: "Air yang jatuh dari ketinggian disebut?", options: ["Sungai", "Air terjun", "Laguna", "Rawa"], correct: 1 },
            { question: "Tanah yang rata dan luas disebut?", options: ["Bukit", "Gunung", "Dataran", "Lembah"], correct: 2 },
            { question: "Perairan luas dan asin disebut?", options: ["Sungai", "Danau", "Rawa", "Laut"], correct: 3 },
            { question: "Apa yang dimaksud dengan efek rumah kaca?", options: ["Gas perangkap panas", "Pendinginan bumi", "Hujan asam", "Pembentukan awan"], correct: 0 },
            { question: "Gas utama penyebab efek rumah kaca adalah?", options: ["Oksigen", "Karbon dioksida", "Nitrogen", "Hidrogen"], correct: 1 },
            { question: "Dampak utama dari efek rumah kaca berlebih?", options: ["Pemanasan global", "Pendinginan global", "Hujan lebat", "Angin kencang"], correct: 0 },
            { question: "Penyebab utama gas rumah kaca?", options: ["Menanam pohon", "Bahan bakar fosil", "Energi surya", "Berkebun"], correct: 1 },
            { question: "Akibat naiknya permukaan air laut?", options: ["Pulau tenggelam", "Gunung baru", "Iklim dingin", "Tanah subur"], correct: 0 },
            { question: "Sumber energi ramah lingkungan adalah?", options: ["Batu bara", "Surya & Angin", "Minyak bumi", "Gas alam"], correct: 1 },
            { question: "Tujuan penghijauan adalah?", options: ["Serap CO‚ÇÇ", "Banyak bangunan", "Kurangi oksigen", "Naikkan suhu"], correct: 0 },
            { question: "Letak lintang Indonesia?", options: ["6¬∞LS - 11¬∞LU", "6¬∞LU - 11¬∞LS", "95¬∞BT - 141¬∞BT", "0¬∞ - 23,5¬∞LU"], correct: 1 },
            { question: "Garis lintang 0¬∞ disebut?", options: ["Greenwich", "Khatulistiwa", "Tropik", "Meridian"], correct: 1 },
            { question: "Garis datar & tegak di peta disebut?", options: ["Garis lintang", "Garis astronomis", "Garis bujur", "Garis khatulistiwa"], correct: 1 },
            { question: "Jumlah zona waktu Indonesia?", options: ["2 zona", "3 zona", "4 zona", "5 zona"], correct: 1 },
            { question: "WIB, WITA, WIT adalah singkatan?", options: ["Waktu Indonesia", "Wilayah Indonesia", "Warga Indonesia", "Waktu Internasional"], correct: 0 },
            { question: "Iklim negara Indonesia adalah?", options: ["Subtropis", "Tropis", "Sedang", "Dingin"], correct: 1 },
            { question: "Dampak pencemaran udara?", options: ["Ganggu kesehatan", "Udara bersih", "Tambah O‚ÇÇ", "Suhu turun"], correct: 0 },
            { question: "Kenapa kita tidak terpeleset saat berjalan?", options: ["Kaki berat", "Gaya gesek", "Lantai kasar", "Hati-hati"], correct: 1 },
            { question: "Arah gaya gesek selalu?", options: ["Searah gerak", "Berlawanan gerak", "Ke atas", "Ke bawah"], correct: 1 },
            { question: "Jumlah lapisan utama bumi?", options: ["2", "3", "4", "5"], correct: 2 },
            { question: "Lapisan bumi paling tebal?", options: ["Kerak", "Mantel", "Inti luar", "Inti dalam"], correct: 1 },
            { question: "Jika 2 lempeng bertabrakan, maka terjadi?", options: ["Laut", "Gunung", "Sungai", "Hutan"], correct: 1 },
            { question: "Penyebab gempa bumi?", options: ["Hujan", "Gesekan lempeng", "Angin", "Panas"], correct: 1 },
            { question: "Lapisan bumi tempat tinggal kita?", options: ["Kerak Bumi", "Mantel", "Inti Luar", "Inti Dalam"], correct: 0 },
            { question: "Paku termasuk benda?", options: ["Magnetis", "Non-Magnetis", "Konduktor", "Isolator"], correct: 0 },
            { question: "Pensil kayu termasuk benda?", options: ["Magnetis", "Non-Magnetis", "Konduktor", "Logam"], correct: 1 },
            { question: "Apa itu musim?", options: ["Perubahan cuaca tahunan", "Suhu harian", "Angin kencang", "Kelembaban"], correct: 0 },
            { question: "Jumlah pergantian musim di Indonesia?", options: ["2 kali", "4 kali", "1 kali", "12 kali"], correct: 0 },
            { question: "Perbedaan cuaca dan iklim?", options: ["Iklim jangka panjang", "Cuaca lebih panas", "Sama saja", "Iklim tiap hari"], correct: 0 },
            { question: "Kenapa Indonesia iklim tropis?", options: ["Di Khatulistiwa", "Jauh dari laut", "Ada gunung", "Banyak pulau"], correct: 0 },
            { question: "Ciri musim hujan?", options: ["Sering hujan", "Langit cerah", "Suhu dingin", "Angin ribut"], correct: 0 },
            { question: "Tanaman saat kemarau?", options: ["Gugurkan daun", "Makin subur", "Banyak bunga", "Berbuah lebat"], correct: 0 },
            { question: "Serangga saat musim hujan?", options: ["Laron", "Kupu-kupu", "Lebah", "Semut"], correct: 0 },
            { question: "Negara iklim subtropis?", options: ["Jepang", "Indonesia", "Malaysia", "Singapura"], correct: 0 },
            { question: "Apa itu gaya?", options: ["Kekuatan angkat", "Tarikan/Dorongan", "Benda gerak", "Berat benda"], correct: 1 },
            { question: "Buah jatuh karena gaya?", options: ["Otot", "Magnet", "Gravitasi", "Gesek"], correct: 2 },
            { question: "Mobil direm berhenti karena gaya?", options: ["Otot", "Magnet", "Gravitasi", "Gesek"], correct: 3 },
            { question: "Membuka pintu adalah?", options: ["Tarikan", "Dorongan", "Angkatan", "Putaran"], correct: 0 },
            { question: "Menendang bola adalah?", options: ["Tarikan", "Dorongan", "Angkatan", "Putaran"], correct: 1 },
            { question: "Bensin mobil diubah jadi energi?", options: ["Gerak", "Cahaya", "Panas", "Listrik"], correct: 0 },
            { question: "Kontributor perubahan iklim?", options: ["Bakar fosil", "Tanam pohon", "Energi surya", "Organik"], correct: 0 },
            { question: "Cuaca ekstrem akibat perubahan iklim?", options: ["Angin sepoi", "Badai & Banjir", "Kabut", "Cerah"], correct: 1 },
            { question: "Fungsi pohon bagi iklim?", options: ["Serap CO‚ÇÇ", "Hasilkan listrik", "Kurangi angin", "Turunkan suhu"], correct: 0 },
            { question: "Apa itu peta?", options: ["Lukisan", "Gambar permukaan bumi", "Foto udara", "Denah rumah"], correct: 1 },
            { question: "Penunjuk arah di peta?", options: ["Skala", "Legenda", "Mata angin", "Judul"], correct: 2 },
            { question: "Arti skala 1:100.000?", options: ["1cm = 1km", "1cm = 100km", "1m = 100m", "Diperbesar"], correct: 0 },
            { question: "Fungsi utama peta?", options: ["Hiasan", "Kirim paket", "Cari lokasi", "Mainan"], correct: 2 }
        ];

        // --- GLOBAL VARIABLES ---
        let currentQuestions = [];
        let currentIndex = 0;
        let score = 0;
        let studentName = "";
        let startTime, timerInterval;
        let audioCtx;

        // --- INITIALIZATION ---
        document.addEventListener('DOMContentLoaded', () => {
            const nameInput = document.getElementById('nameInput');
            const startBtn = document.getElementById('startBtn');
            
            nameInput.addEventListener('input', (e) => {
                startBtn.disabled = e.target.value.trim().length === 0;
            });
            
            startBtn.addEventListener('click', startQuiz);
        });

        // --- AUDIO SYSTEM (Sound Effect) ---
        function initAudio() {
            if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        }

        function playTone(type) {
            initAudio();
            if (audioCtx.state === 'suspended') audioCtx.resume();
            const osc = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();
            osc.connect(gainNode);
            gainNode.connect(audioCtx.destination);

            if (type === 'correct') {
                // Suara "Ting" Menyenangkan
                osc.type = 'sine';
                osc.frequency.setValueAtTime(600, audioCtx.currentTime);
                osc.frequency.exponentialRampToValueAtTime(1000, audioCtx.currentTime + 0.1);
                gainNode.gain.setValueAtTime(0.3, audioCtx.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.5);
                osc.start(); osc.stop(audioCtx.currentTime + 0.5);
            } else {
                // Suara "Buzzer" Lucu
                osc.type = 'sawtooth';
                osc.frequency.setValueAtTime(150, audioCtx.currentTime);
                osc.frequency.linearRampToValueAtTime(100, audioCtx.currentTime + 0.3);
                gainNode.gain.setValueAtTime(0.3, audioCtx.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.4);
                osc.start(); osc.stop(audioCtx.currentTime + 0.4);
            }
        }

        // --- TTS SYSTEM (Suara Perempuan) ---
        function speakText(text) {
            if ('speechSynthesis' in window) {
                window.speechSynthesis.cancel();
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = 'id-ID'; // Bahasa Indonesia
                utterance.rate = 1.0;
                utterance.pitch = 1.2; // Sedikit lebih tinggi biar ceria
                
                // Cari suara Google Bahasa Indonesia jika ada
                const voices = window.speechSynthesis.getVoices();
                const indo = voices.find(v => v.lang.includes('id'));
                if (indo) utterance.voice = indo;
                
                window.speechSynthesis.speak(utterance);
            }
        }

        // --- LOGIKA GAME ---
        function startQuiz() {
            studentName = document.getElementById('nameInput').value.trim();
            document.getElementById('inputSection').style.display = 'none';
            document.getElementById('quizSection').style.display = 'block';
            
            // Randomize Soal
            currentQuestions = shuffleArray([...allQuestions]);
            // Randomize Opsi dalam soal
            currentQuestions = currentQuestions.map(q => shuffleOptions(q));
            
            currentIndex = 0;
            score = 0;
            startTime = new Date();
            timerInterval = setInterval(updateTimer, 1000);
            
            showQuestion();
        }

        function updateTimer() {
            const diff = Math.floor((new Date() - startTime) / 1000);
            const m = Math.floor(diff / 60).toString().padStart(2, '0');
            const s = (diff % 60).toString().padStart(2, '0');
            document.getElementById('timerDisplay').textContent = `‚è±Ô∏è ${m}:${s}`;
        }

        function showQuestion() {
            const q = currentQuestions[currentIndex];
            document.getElementById('qCount').textContent = `‚≠ê Soal ${currentIndex + 1} / ${currentQuestions.length}`;
            
            const container = document.getElementById('questionContainer');
            const labels = ['A', 'B', 'C', 'D'];
            
            // Render HTML Soal (Kotak Biru) dan Opsi (Grid)
            let html = `
                <div class="question-box">
                    <div class="question-text">
                        ${q.question}
                        <button class="speaker-btn" onclick="speakCurrent()">üîä</button>
                    </div>
                </div>
                <div class="options-grid">`;
            
            q.options.forEach((opt, i) => {
                html += `
                <button class="option-btn" id="btn-${i}" onclick="check(${i})">
                    <span class="option-label">${labels[i]}</span>
                    ${opt}
                </button>`;
            });
            html += `</div>`;
            
            container.innerHTML = html;
            speakCurrent();
        }

        function speakCurrent() {
            const q = currentQuestions[currentIndex];
            let t = q.question + ". ";
            const lbl = ['A', 'B', 'C', 'D'];
            q.options.forEach((opt, i) => t += lbl[i] + ". " + opt + ". ");
            speakText(t);
        }

        function check(idx) {
            window.speechSynthesis.cancel(); // Stop suara
            const q = currentQuestions[currentIndex];
            const btns = document.querySelectorAll('.option-btn');
            btns.forEach(b => b.disabled = true);
            
            const isCorrect = (idx === q.correct);
            const selBtn = document.getElementById(`btn-${idx}`);
            const corBtn = document.getElementById(`btn-${q.correct}`);
            
            if (isCorrect) {
                score++;
                selBtn.classList.add('correct');
                playTone('correct');
                showPopup(true);
            } else {
                selBtn.classList.add('incorrect');
                corBtn.classList.add('correct');
                playTone('wrong');
                showPopup(false);
            }
            
            setTimeout(nextQuestion, 1200); // Jeda 1.2 detik
        }

        function showPopup(isCorrect) {
            const el = document.createElement('div');
            el.className = 'popup-jumbo ' + (isCorrect ? 'pop-plus' : 'pop-zero');
            el.textContent = isCorrect ? '+1' : '0';
            document.body.appendChild(el);
            setTimeout(() => el.remove(), 1200);
        }

        function nextQuestion() {
            currentIndex++;
            if (currentIndex < currentQuestions.length) showQuestion();
            else endQuiz();
        }

        function endQuiz() {
            clearInterval(timerInterval);
            document.getElementById('quizSection').style.display = 'none';
            document.getElementById('resultSection').style.display = 'block';
            
            const finalScore = Math.round((score / currentQuestions.length) * 100);
            const timeStr = document.getElementById('timerDisplay').textContent.replace('‚è±Ô∏è ', '');
            
            document.getElementById('finalScoreDisplay').textContent = finalScore;
            document.getElementById('resName').textContent = studentName;
            document.getElementById('resCorrect').textContent = score;
            document.getElementById('resWrong').textContent = currentQuestions.length - score;
            document.getElementById('resTime').textContent = timeStr + " mnt";
            
            submitScore(studentName, finalScore, score, currentQuestions.length);
        }

        function shuffleArray(arr) {
            return arr.sort(() => Math.random() - 0.5);
        }

        function shuffleOptions(q) {
            let newQ = JSON.parse(JSON.stringify(q));
            let opts = newQ.options;
            let correctText = opts[newQ.correct];
            opts = shuffleArray(opts);
            newQ.options = opts;
            newQ.correct = opts.indexOf(correctText);
            return newQ;
        }

        function submitScore(nama, nilai, benar, total) {
            const fd = new FormData();
            fd.append('nama', nama);
            fd.append('skor', nilai);
            fd.append('benar', benar);
            fd.append('total', total);
            fd.append('timestamp', new Date().toISOString());

            fetch(SCRIPT_URL, { method: 'POST', body: fd })
                .then(() => {
                    document.getElementById('saveStatus').innerHTML = "‚úÖ Nilai Berhasil Disimpan!";
                    document.getElementById('saveStatus').style.color = "#2E7D32";
                    document.getElementById('saveStatus').style.background = "#E8F5E9";
                })
                .catch(() => {
                    document.getElementById('saveStatus').innerHTML = "‚ö†Ô∏è Gagal Simpan Online (Cek Sinyal)";
                    document.getElementById('saveStatus').style.color = "#C62828";
                    document.getElementById('saveStatus').style.background = "#FFEBEE";
                });
        }
    </script>
</body>
</html>